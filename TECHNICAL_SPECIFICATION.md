# Техническое задание на разработку устройства ComToAir

## 1. Общие сведения

### 1.1. Наименование проекта
**ComToAir** - устройство для приема данных по интерфейсу RS-232 и трансляции их через WiFi в виде веб-сервиса.

### 1.2. Цель проекта
Разработка устройства, обеспечивающего прием данных от устройств с интерфейсом RS-232 и предоставление доступа к этим данным через веб-интерфейс по WiFi.

### 1.3. Целевая платформа
- **Микроконтроллер**: Seeed Studio XIAO ESP32-C6
- **Среда разработки**: Visual Studio Code
- **Framework**: PlatformIO с ESP-IDF
- **Язык программирования**: C/C++

## 2. Технические требования

### 2.1. Аппаратная часть

#### 2.1.1. Основной контроллер
- **Модель**: Seeed Studio XIAO ESP32-C6
- **Процессор**: ESP32-C6 (RISC-V, 160 MHz)
- **WiFi**: IEEE 802.11 b/g/n (2.4 GHz)
- **Bluetooth**: BLE 5.0
- **Память**: 320 KB SRAM, 512 KB Flash
- **GPIO**: 11 цифровых портов

#### 2.1.2. Интерфейс RS-232
- **Преобразователь**: Внешний преобразователь уровня TTL ↔ RS-232 (например, MAX232 или аналог)
- **Подключение**: 
  - RX (TTL) → GPIO контроллера
  - TX (TTL) → GPIO контроллера
  - GND → общий провод
- **Параметры связи**:
  - Скорость: настраиваемая (9600, 19200, 38400, 57600, 115200 бод)
  - Биты данных: 8
  - Стоп-биты: 1 или 2 (настраиваемо)
  - Четность: None, Even, Odd (настраиваемо)
  - Управление потоком: RTS/CTS (опционально)

### 2.2. Программная часть

#### 2.2.1. Среда разработки
- **IDE**: Visual Studio Code
- **Расширение**: PlatformIO IDE
- **Framework**: ESP-IDF (Espressif IoT Development Framework)
- **Версия ESP-IDF**: последняя стабильная (рекомендуется v5.x)

#### 2.2.2. Структура проекта
```
ComToAir/
├── platformio.ini          # Конфигурация PlatformIO
├── README.md               # Описание проекта
├── TECHNICAL_SPECIFICATION.md  # Техническое задание
├── src/
│   └── main.cpp            # Основной файл приложения
├── include/                # Заголовочные файлы
│   ├── rs232_handler.h     # Обработчик RS-232
│   ├── wifi_manager.h      # Управление WiFi
│   ├── web_server.h        # Веб-сервер
│   └── config.h            # Конфигурация
├── data/                   # Статические файлы (HTML, CSS, JS)
│   └── index.html          # Веб-интерфейс
└── test/                   # Тесты
```

## 3. Функциональные требования

### 3.1. Прием данных по RS-232
- Прием данных от внешнего устройства через интерфейс RS-232
- Буферизация входящих данных
- Обработка различных скоростей передачи
- Поддержка настраиваемых параметров связи (скорость, четность, стоп-биты)
- Обработка ошибок связи (таймауты, переполнение буфера)

### 3.2. WiFi подключение
- Подключение к существующей WiFi сети (режим Station)
- Возможность работы в режиме точки доступа (AP) для первоначальной настройки
- Автоматическое переподключение при потере связи
- Индикация статуса подключения
- Настраиваемые параметры сети (SSID, пароль)

### 3.3. Веб-сервис
- HTTP сервер на порту 80 (настраиваемый)
- RESTful API для получения данных
- Веб-интерфейс для мониторинга данных в реальном времени
- WebSocket для потоковой передачи данных (опционально)
- API endpoints:
  - `GET /` - главная страница с веб-интерфейсом
  - `GET /api/data` - получение последних данных
  - `GET /api/status` - статус устройства
  - `GET /api/config` - текущая конфигурация
  - `POST /api/config` - изменение конфигурации
  - `GET /api/stream` - потоковая передача данных (WebSocket)

### 3.4. Управление и конфигурация
- Веб-интерфейс для настройки параметров:
  - Параметры RS-232 (скорость, четность, стоп-биты)
  - Параметры WiFi (SSID, пароль, режим работы)
  - Параметры веб-сервера (порт, таймауты)
- Сохранение конфигурации в NVS (Non-Volatile Storage)
- Сброс к заводским настройкам
- Индикация состояния (LED или веб-интерфейс)

## 4. Технические характеристики

### 4.1. Производительность
- Минимальная задержка передачи данных: < 100 мс
- Размер буфера приема: минимум 1024 байта
- Максимальная скорость приема: до 115200 бод
- Поддержка одновременных подключений: до 4 клиентов

### 4.2. Надежность
- Автоматическое восстановление при сбоях
- Защита от переполнения буферов
- Обработка ошибок связи
- Watchdog таймер для предотвращения зависаний

### 4.3. Безопасность
- Возможность установки пароля для веб-интерфейса
- Защита от несанкционированного доступа
- Валидация входящих данных

## 5. Интерфейсы и протоколы

### 5.1. Физический интерфейс
- **RS-232**: 
  - Разъем: DB9 или клеммная колодка
  - Уровни сигналов: ±12V (через преобразователь)
  - Максимальная длина кабеля: до 15 метров

### 5.2. Сетевой интерфейс
- **WiFi**: IEEE 802.11 b/g/n
- **Протокол**: HTTP/HTTPS (опционально)
- **WebSocket**: для потоковой передачи (опционально)

### 5.3. Формат данных
- Текстовый формат для веб-интерфейса
- JSON для API
- Возможность настройки формата вывода

## 6. Этапы разработки

### Этап 1: Подготовка окружения
- Установка Visual Studio Code
- Установка PlatformIO IDE
- Настройка ESP-IDF framework
- Создание структуры проекта

### Этап 2: Базовая функциональность
- Инициализация ESP32-C6
- Настройка UART для RS-232
- Базовая обработка входящих данных
- Тестирование приема данных

### Этап 3: WiFi функциональность
- Подключение к WiFi сети
- Реализация режима точки доступа
- Управление подключением
- Тестирование сетевого подключения

### Этап 4: Веб-сервер
- Реализация HTTP сервера
- Создание REST API
- Разработка веб-интерфейса
- Тестирование веб-сервиса

### Этап 5: Интеграция и оптимизация
- Интеграция всех компонентов
- Оптимизация производительности
- Обработка ошибок
- Тестирование полного функционала

### Этап 6: Документация и финализация
- Написание пользовательской документации
- Создание инструкции по сборке
- Подготовка к развертыванию

## 7. Требования к тестированию

### 7.1. Модульное тестирование
- Тестирование модуля приема RS-232
- Тестирование WiFi модуля
- Тестирование веб-сервера

### 7.2. Интеграционное тестирование
- Тестирование полного цикла передачи данных
- Тестирование при различных нагрузках
- Тестирование восстановления после сбоев

### 7.3. Приемочное тестирование
- Проверка соответствия техническому заданию
- Проверка всех функциональных требований
- Проверка производительности

## 8. Документация

### 8.1. Техническая документация
- Схема подключения
- Описание API
- Код с комментариями

### 8.2. Пользовательская документация
- Инструкция по установке
- Руководство пользователя
- Руководство по настройке

## 9. Ограничения и допущения

### 9.1. Ограничения
- Максимальная скорость RS-232: 115200 бод
- Максимальное количество одновременных подключений: 4
- Размер буфера ограничен доступной памятью ESP32-C6

### 9.2. Допущения
- Преобразователь уровня RS-232 предоставляется отдельно
- Устройство работает от стабильного источника питания 5V
- WiFi сеть доступна в зоне действия устройства

## 10. Критерии приемки

Устройство считается готовым к использованию при выполнении следующих условий:
1. Успешный прием данных по RS-232 с настраиваемыми параметрами
2. Стабильное подключение к WiFi сети
3. Работающий веб-сервис с доступом к данным
4. Веб-интерфейс для мониторинга и настройки
5. Сохранение конфигурации после перезагрузки
6. Обработка ошибок и автоматическое восстановление
7. Документация проекта

## 11. Сроки и ресурсы

### 11.1. Ориентировочные сроки
- Разработка: 2-3 недели
- Тестирование: 1 неделя
- Документация: 3-5 дней

### 11.2. Необходимые ресурсы
- Seeed Studio XIAO ESP32-C6
- Преобразователь уровня RS-232
- Компьютер с Visual Studio Code
- Устройство для тестирования RS-232
- WiFi роутер для тестирования

---

**Версия документа**: 1.0  
**Дата создания**: 2024  
**Статус**: Утверждено


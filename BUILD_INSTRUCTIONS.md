# Инструкция по сборке и развертыванию ComToAir

## Требования

### Аппаратное обеспечение
1. **Seeed Studio XIAO ESP32-C6** - основной контроллер
2. **Преобразователь уровня RS-232** (например, MAX232, SP3232 или аналогичный)
3. **Источник питания 5V** с током не менее 500 мА
4. **USB кабель** для программирования и питания
5. **Устройство с интерфейсом RS-232** для тестирования

### Программное обеспечение
1. **Visual Studio Code** (последняя версия)
2. **PlatformIO IDE** расширение для VS Code
3. **ESP-IDF framework** (устанавливается автоматически через PlatformIO)

## Установка среды разработки

### Шаг 1: Установка Visual Studio Code
1. Скачайте Visual Studio Code с официального сайта: https://code.visualstudio.com/
2. Установите VS Code на ваш компьютер

### Шаг 2: Установка PlatformIO
1. Откройте VS Code
2. Перейдите в раздел Extensions (Ctrl+Shift+X или Cmd+Shift+X на Mac)
3. Найдите "PlatformIO IDE"
4. Нажмите "Install"
5. После установки перезапустите VS Code

### Шаг 3: Открытие проекта
1. В VS Code выберите File → Open Folder
2. Перейдите в папку с проектом ComToAir
3. Откройте папку проекта

## Аппаратное подключение

### Подключение USB-UART преобразователя (PL2303TA)

**ПРАВИЛЬНОЕ подключение (рекомендуется):**

```
USB-UART PL2303TA              XIAO ESP32-C6
─────────────────              ────────────────
Белый провод (TX) ───────────> D1 (GPIO 1, RX)
Зеленый провод (RX) <───────── D0 (GPIO 0, TX)
Черный провод (GND) ────────── GND
Красный провод (VCC) ───────── НЕ ПОДКЛЮЧАТЬ (питание через USB)
```

**Текущее подключение пользователя (компенсировано в коде):**

```
USB-UART PL2303TA              XIAO ESP32-C6
─────────────────              ────────────────
Белый провод (TX) ───────────> D0 (GPIO 0) ⚠️
Зеленый провод (RX) <───────── D1 (GPIO 1) ⚠️
Черный провод (GND) ────────── GND
Красный провод (VCC) ───────── НЕ ПОДКЛЮЧАТЬ
```

**Распиновка кабеля PL2303TA:**
- **Белый провод** - TX (передача от USB-UART)
- **Зеленый провод** - RX (прием в USB-UART)
- **Черный провод** - GND
- **Красный провод** - VCC (5V) → **НЕ ПОДКЛЮЧАТЬ**

**Распиновка XIAO ESP32-C6:**
- **D0** = GPIO 0 (обычно используется как TX для UART)
- **D1** = GPIO 1 (обычно используется как RX для UART)

**Важно:**
- Для правильной работы UART нужно **перекрестное подключение**: TX USB-UART → RX ESP32, RX USB-UART → TX ESP32
- Текущее подключение (белый→D0, зеленый→D1) **неправильное**, но компенсировано в коде
- **Рекомендуется переподключить провода правильно** для лучшей стабильности:
  - Белый (TX USB-UART) → D1 (RX ESP32, GPIO 1)
  - Зеленый (RX USB-UART) → D0 (TX ESP32, GPIO 0)
- **НЕ подключайте красный провод (VCC)** - XIAO ESP32-C6 питается через собственный USB порт
- Уровни сигналов TTL 3.3V совместимы с PL2303TA

### Подключение питания
- Подключите USB кабель к XIAO ESP32-C6 для питания и программирования
- Или используйте внешний источник питания 5V через соответствующий разъем

## Компиляция и загрузка прошивки

### Шаг 1: Подключение устройства
1. Подключите XIAO ESP32-C6 к компьютеру через USB кабель
2. Убедитесь, что устройство распознано системой

### Шаг 2: Компиляция проекта
1. В VS Code откройте терминал PlatformIO (View → Terminal или иконка терминала внизу)
2. Выполните команду:
```bash
pio run
```
3. Дождитесь завершения компиляции

### Шаг 3: Загрузка прошивки
1. После успешной компиляции выполните:
```bash
pio run --target upload
```
2. Или используйте кнопку "Upload" в панели PlatformIO

### Шаг 4: Мониторинг последовательного порта
1. Для просмотра логов выполните:
```bash
pio device monitor
```
2. Или используйте кнопку "Monitor" в панели PlatformIO

## Первоначальная настройка

### Подключение к WiFi точке доступа
1. После загрузки прошивки устройство создаст WiFi точку доступа:
   - **SSID**: `ComToAir_AP`
   - **Пароль**: `12345678`
2. Подключитесь к этой сети с вашего компьютера или мобильного устройства
3. Откройте браузер и перейдите по адресу: `http://192.168.4.1`

### Настройка через веб-интерфейс
1. В веб-интерфейсе перейдите в раздел настроек
2. Настройте параметры RS-232:
   - Скорость передачи (9600, 19200, 38400, 57600, 115200)
   - Четность (None, Even, Odd)
   - Стоп-биты (1, 2)
3. Настройте WiFi (опционально):
   - SSID вашей сети
   - Пароль сети
   - Режим работы (Station или AP)

## Тестирование

### Тест приема данных по RS-232
1. Подключите тестовое устройство с RS-232
2. Настройте параметры связи на обоих устройствах
3. Отправьте данные с тестового устройства
4. Проверьте отображение данных в веб-интерфейсе

### Тест веб-интерфейса
1. Откройте веб-интерфейс в браузере
2. Проверьте отображение статуса устройства
3. Проверьте получение данных в реальном времени
4. Протестируйте все функции интерфейса

## Устранение неполадок

### Устройство не загружается
- Проверьте USB подключение
- Убедитесь, что установлены драйверы USB-to-Serial
- Попробуйте другой USB кабель или порт
- Проверьте, что устройство находится в режиме загрузки

### Ошибки компиляции
- Убедитесь, что установлен ESP-IDF framework
- Проверьте версию PlatformIO (должна быть последняя)
- Очистите проект: `pio run --target clean`
- Пересоберите проект: `pio run`

### WiFi не подключается
- Проверьте правильность SSID и пароля
- Убедитесь, что сеть работает на частоте 2.4 GHz
- Проверьте расстояние до роутера
- Попробуйте перезагрузить устройство

### Данные не поступают
- Проверьте подключение RS-232
- Убедитесь, что параметры связи совпадают на обоих устройствах
- Проверьте правильность подключения TX/RX
- Проверьте уровни сигналов преобразователя

## Дополнительная информация

### Изменение конфигурации по умолчанию
Конфигурационные параметры можно изменить в файле `include/config.h`:
- Параметры UART
- Настройки WiFi
- Настройки веб-сервера

### Добавление новых функций
Структура проекта позволяет легко добавлять новые модули:
- Создайте заголовочный файл в `include/`
- Реализуйте функции в `src/`
- Подключите модуль в `main.cpp`

## Поддержка

При возникновении проблем:
1. Проверьте логи через монитор последовательного порта
2. Изучите техническое задание в `TECHNICAL_SPECIFICATION.md`
3. Проверьте документацию ESP-IDF: https://docs.espressif.com/projects/esp-idf/

